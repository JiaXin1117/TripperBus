<div *ngIf="reservations && !reservations.length" class="panel panel-default" style="margin-top: 94px">
    <div>
        <h4>
            <span class="label label-danger">Your search for a 
              <span class="badge">{{ inputParams.searchKey }}</span> containing 
              <span class="badge">{{ inputParams.searchVal }}</span> found nothing.
            </span>
        </h4>
    </div>
</div>

<div *ngIf="reservations && reservations.length" class="text-center header-div">
    <div class="container" style="margin: 30px">
        <div class="col-sm-6">
            <a class="btn" (click)="showSelectedModal()" [class.disabled]="!selectedReservations || !selectedReservations.length" [class.btn-default]="!selectedReservations || !selectedReservations.length"
                [class.btn-success]="selectedReservations && selectedReservations.length">Selected Reservations</a>
        </div>
        <div class="col-sm-6">
            <ss-multiselect-dropdown class="text-left" [options]="fieldOptions" [texts]="fieldTexts" [settings]="fieldSettings" [(ngModel)]="showField"
                (ngModelChange)="onShowFieldChange($event)"></ss-multiselect-dropdown>
        </div>
    </div>
</div>

<div *ngIf="reservations && reservations.length" class="panel panel-default">
    <div>
        <h4>
            <span class="label label-primary">Your search for a 
              <span class="badge">{{ inputParams.searchKey }}</span> containing 
              <span class="badge">{{ inputParams.searchVal }}</span> found the following 
              <span class="badge">{{reservations.length}}</span> records:
            </span>
        </h4>
    </div>
    <div style="overflow-x:scroll">
        <table class="table table-striped table-bordered" [mfData]="reservations" #mf="mfDataTable" [mfRowsOnPage]="10000" (mfSelectedEntities)="onSelectedReservations($event)">
            <thead>
                <tr>
                    <th><mfRowSelectorHead></mfRowSelectorHead></th>
                    <th><mfDefaultSorter by="First Name">First Name</mfDefaultSorter></th>
                    <th><mfDefaultSorter by="Last Name">Last Name</mfDefaultSorter></th>
                    <th><mfDefaultSorter by="date">Date</mfDefaultSorter></th>
                    <th><mfDefaultSorter by="time">Time</mfDefaultSorter></th>
                    <th><mfDefaultSorter by="stop">Stop</mfDefaultSorter></th>
                    <th><mfDefaultSorter by="Phone">Phone</mfDefaultSorter></th>
                    <th><mfDefaultSorter by="Email">Email</mfDefaultSorter></th>
                    <th><mfDefaultSorter by="Seats">Seats</mfDefaultSorter></th>
                    <th *ngFor="let field of showField">
                        <mfDefaultSorter by="{{fieldOptions[field - 1].name}}">{{fieldOptions[field - 1].name}}</mfDefaultSorter>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of mf.data; let ndx = index">
                    <td><mfRowSelector [entity]="item" [checkboxId]="ndx"></mfRowSelector></td>
                    <td><a (click)="editReservation(item);">{{item['First Name']}}</a></td>
                    <td><a (click)="editReservation(item);">{{item['Last Name']}}</a></td>
                    <td>{{item['date']}}</td>
                    <td>{{item['time']}}</td>
                    <td>{{item['stop']}}</td>
                    <td>{{item['Phone']}}</td>
                    <td>{{item['Email']}}</td>
                    <td>{{item['Seats']}}</td>
                    <td *ngFor="let field of showField">
                        <ng-template [ngIf]='fieldOptions[field - 1].name !== "Authorize net Link"'>
                            {{item[fieldOptions[field - 1].name]}}
                        </ng-template>
                        <ng-template [ngIf]='fieldOptions[field - 1].name === "Authorize net Link"'>
                            <a href="{{authorize_net_url + item[fieldOptions[field - 1].name]}}" target="_blank">
                                {{item[fieldOptions[field - 1].name]}}
                            </a>
                        </ng-template>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Reservation Modal -->
<div bsModal #reservationModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content col-xs-12">
            <div class="modal-header" style="border-bottom: none">
                <button type="button" class="close pull-right" aria-label="Close" (click)="hideReservationModal()">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div *ngIf="myReservation" class="modal-body">
                <div>
                    <div class="form-group col-xs-6" display="inline-block">
                        <label for="reservation_first_name">First Name</label>
                        <input type="name" class="form-control" id="reservation_first_name" [(ngModel)]="myReservation['First Name']">
                    </div>
                    <div class="form-group col-xs-6" display="inline-block">
                        <label for="reservation_last_name">Last Name</label>
                        <input type="name" class="form-control" id="reservation_last_name" [(ngModel)]="myReservation['Last Name']">
                    </div>
                </div>
                <div>
                    <div class="form-group col-xs-6" display="inline-block">
                        <label for="reservation_phone">Phone</label>
                        <input type="text" class="form-control" id="reservation_phone" [(ngModel)]="myReservation['Phone']">
                    </div>
                    <div class="form-group col-xs-6" display="inline-block">
                        <label for="reservation_email">Email</label>
                        <input type="email" class="form-control" id="reservation_email" [(ngModel)]="myReservation['Email']">
                    </div>
                </div>
                <div>
                    <div class="form-group col-xs-4" display="inline-block">
                        <label for="reservation_seats">Seats</label>
                        <input type="number" min="0" class="form-control" id="reservation_seats" [(ngModel)]="myReservation['Seats']" (ngModelChange)="onSeatsChange($event)">
                    </div>
                    <div class="form-group col-xs-4" display="inline-block">
                        <label for="reservation_payment_method">Payment Method</label>
                        <select id="reservation_payment_method" class="form-control" [(ngModel)]="myReservation['Payment Method']" (ngModelChange)="onPaymentMethodChange($event)" disabled>
                            <option value="Credit Card">Credit Card</option>
                            <option value="Ivy Media">Ivy Media</option>
                            <option value="Coupons/Points">Coupons/Points</option>
                            <option value="No Payment">No Payment</option>
                            <option value="Cust. Already Paid">Cust. Already Paid</option>
                            <option value="Re-Scheduled Old Trip">Re-Scheduled Old Trip</option>
                        </select>
                    </div>
                    <div class="form-group col-xs-4" display="inline-block">
                        <label for="reservation_transaction_amount">Transaction Amount</label>
                        <div class="input-group">
                            <div class="input-group-addon">$</div>
                            <input type="text" class="form-control" id="reservation_transaction_amount" [(ngModel)]="myReservation['Transaction Amount']" disabled>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12">
                    <div class="form-group">
                        <label for="reservation_notes">Note</label>
                        <textarea class="form-control" rows="5" id="reservation_notes" [(ngModel)]="myReservation['Note']">
                        </textarea>
                    </div>
                </div>
                <div class="col-xs-12">
                    <div class="form-group">
                        <label for="reservation_date">Date</label>
                        <material-datepicker id="reservation_date" [placeholder]="'Select a date'" [(date)]="myReservationDate" [dateFormat]="'YYYY-MM-DD'" (onSelect)="onSelectReservationDate()"></material-datepicker>
                    </div>
                    <div class="form-group">
                        <label for="reservation_time">Bus & Time</label>
                        <h5 *ngIf="!myReservationBuses.length"> There is no bus. </h5>
                        <div class="col-xs-12" *ngFor="let bus of myReservationBuses; let i=index;">
                            <div class="col-xs-12 bus-root-div">
                                <h5 class="text-center bus-header-h5">BUS #{{ i + 1 }}</h5>

                                <div class="group-main-info">
                                    <table class="schedules-table">
                                        <tr *ngFor="let time of bus.times; let j = index;">
                                            <td class="td-left">
                                                <b><span>
                                                    <input type="radio" [name]="'Time'" class="form-control radio-btn" [checked]="myReservation['time_id']==time.id"(click)="onSelectReservationTime(time.id);">
                                                    {{ time.time }}</span> from <span>{{ time.stop_area }}
                                                </span></b>
                                            </td>
                                            <td class="td-right">
                                                <span>{{ time.reservation_cnt }}</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="group-additional-info">
                                    <h5 class="total-h5">
                                        Total: {{ bus['totalSeats'] }}. Max Capacity: {{bus.max_cap}}
                                    </h5>
<!--                                    <table class="group-additional-info-table">
                                        <tr>
                                            <td class="td-left">
                                                Coupons Allowed:
                                            </td>
                                            <td class="td-right">

                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="td-left">
                                                Price:
                                            </td>
                                            <td class="td-right">
                                                ${{price}}
                                            </td>
                                        </tr>
                                    </table>-->
                                </div>
                                <div class="group-additional-info">
                                    <table class="group-additional-info-table">
                                        <tr>
                                            <td class="td-left">
                                                Destinations:
                                            </td>
                                            <td class="td-right">
                                                {{bus.destination}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="td-left">
                                                Bus is:
                                            </td>
                                            <td class="td-right">
                                                {{bus.price.bus_opened==0?'Open':'Closed'}}
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xs-12">
                    <div class="form-group pull-right" style="margin-top: 20px; margin-bottom: 20px">
                        <button type="submit" class="btn btn-success" (click)="addReservationSeats()">Add</button>
                        <button type="submit" class="btn btn-primary" (click)="updateReservation()">Update</button>
                        <button type="submit" class="btn btn-warning" (click)="holdReservation()">Place on Hold</button>
                        <button type="submit" class="btn btn-danger" (click)="deleteSoftReservation()">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Selected Reservations Modal -->
<div bsModal #selectedModal="bs-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content col-xs-12">
            <div class="modal-header" style="border-bottom: none">
                <button type="button" class="close pull-right" aria-label="Close" (click)="hideSelectedModal()">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div *ngIf="selectedReservations && selectedReservations.length" class="modal-body">
                <div>
                    <div class="form-group col-xs-8" display="inline-block">
                        <label for="selected_mass_action">Mass Action</label>
                        <select id="selected_mass_action" class="form-control" [(ngModel)]="massAction">
                            <option value="Delete">Delete</option>
                            <option value="Place on Hold">Place on Hold</option>
                            <option value="Note">Note</option>
                            <option value="Re-Email">Re-Email</option>
                            <option value="Custom Email Only">Custom Email Only</option>
                            <option value="Text Only">Text Only</option>
                            <option value="Custom Email & Text">Custom Email & Text</option>
                            <option value="Complimentary Seats as Reserved">Complimentary Seats as Reserved</option>
                            <option value="Complimentary One Seat">Complimentary One Seat</option>
                        </select>
                    </div>
                    <div class="form-group col-xs-4" style="margin-top: 23px">
                        <button type="submit" class="btn col-xs-8 pull-right" (click)="doMassAction()"
                        [class.btn-danger]="massAction == 'Delete'"
                        [class.btn-warning]="massAction == 'Place on Hold'"
                        [class.btn-primary]="massAction != 'Delete' && massAction != 'Place on Hold'"> OK  </button>
                    </div>
                </div>
                <div class="form-group col-xs-12" [ngSwitch]="massAction">
                    <ng-container *ngSwitchCase="'Place on Hold'">
                        <label for="reservation_mass_text">Email Subject</label>
                        <input class="form-control" id="reservation_mass_text" 
                        [(ngModel)]="massText" 
                        [maxlength]="_mainService.reservation_emailsubject_maxlength" 
                        [placeholder]="_mainService.reservation_emailsubject_placeholder_hold" 
                        [title]="_mainService.reservation_emailsubject_desc">
                        <br/>
                        <label for="reservation_mass_text1">Email Body</label>
                        <textarea class="form-control" rows="5" id="reservation_mass_text1" 
                        [(ngModel)]="massText1" 
                        [maxlength]="_mainService.reservation_text_maxlength"
                        [title]="_mainService.reservation_emailbody_desc_hold"></textarea>
                    </ng-container>

                    <ng-container *ngSwitchCase="'Note'">
                        <label for="reservation_mass_text1">Note</label>
                        <textarea class="form-control" rows="5" id="reservation_mass_text1" 
                        [(ngModel)]="massText1" 
                        [maxlength]="_mainService.reservation_text_maxlength"
                        [title]="_mainService.reservation_emailbody_desc_note"></textarea>
                    </ng-container>

                    <ng-container *ngSwitchCase="'Re-Email'">
                        <label for="reservation_mass_text">Email Subject</label>
                        <input class="form-control" id="reservation_mass_text" 
                        [(ngModel)]="massText" 
                        [maxlength]="_mainService.reservation_emailsubject_maxlength" 
                        [placeholder]="_mainService.reservation_emailsubject_placeholder_reemail"
                        [title]="_mainService.reservation_emailsubject_desc">
                    </ng-container>

                    <ng-container *ngSwitchCase="'Custom Email Only'">
                        <label for="reservation_mass_text">Email Subject</label>
                        <input class="form-control" id="reservation_mass_text" 
                        [(ngModel)]="massText" 
                        [maxlength]="_mainService.reservation_emailsubject_maxlength" 
                        [placeholder]="_mainService.reservation_emailsubject_placeholder_customemail"
                        [title]="_mainService.reservation_emailsubject_desc">
                        <br/>
                        <label for="reservation_mass_text1">Email Body</label>
                        <textarea class="form-control" rows="5" id="reservation_mass_text1" 
                        [(ngModel)]="massText1" 
                        [maxlength]="_mainService.reservation_text_maxlength"
                        [title]="_mainService.reservation_emailbody_desc_customemail"></textarea>
                    </ng-container>

                    <ng-container *ngSwitchCase="'Text Only'">
                        <label for="reservation_mass_text1">Text</label>
                        <textarea class="form-control" rows="5" id="reservation_mass_text1" 
                        [(ngModel)]="massText1" 
                        [maxlength]="_mainService.reservation_text_maxlength"
                        [title]="_mainService.reservation_text_desc"></textarea>
                    </ng-container>

                    <ng-container *ngSwitchCase="'Custom Email & Text'">
                        <label for="reservation_mass_text">Email Subject</label>
                        <input class="form-control" id="reservation_mass_text" 
                        [(ngModel)]="massText" 
                        [maxlength]="_mainService.reservation_emailsubject_maxlength" 
                        [placeholder]="_mainService.reservation_emailsubject_placeholder_customemail"
                        [title]="_mainService.reservation_emailsubject_desc">
                        <br/>
                        <label for="reservation_mass_text1">Email Body</label>
                        <textarea class="form-control" rows="5" id="reservation_mass_text1" 
                        [(ngModel)]="massText1" 
                        [maxlength]="_mainService.reservation_text_maxlength"
                        [title]="_mainService.reservation_emailbody_desc_customemail"></textarea>
                        <br/><br/>
                        <label for="reservation_mass_text2">Text</label>
                        <textarea class="form-control" rows="5" id="reservation_mass_text2" 
                        [(ngModel)]="massText2"
                        [title]="_mainService.reservation_text_desc"></textarea>
                    </ng-container>

                    <ng-container *ngSwitchCase="'Complimentary Seats as Reserved'">
                        <label for="reservation_mass_text">Email Subject</label>
                        <input class="form-control" id="reservation_mass_text" 
                        [(ngModel)]="massText" 
                        [maxlength]="_mainService.reservation_emailsubject_maxlength" 
                        [placeholder]="_mainService.reservation_emailsubject_placeholder_complimentary"
                        [title]="_mainService.reservation_emailsubject_desc">
                        <br/>
                        <label for="reservation_mass_text1">Email Body</label>
                        <textarea class="form-control" rows="5" id="reservation_mass_text1" 
                        [(ngModel)]="massText1" 
                        [maxlength]="_mainService.reservation_text_maxlength"
                        [title]="_mainService.reservation_emailbody_desc_complimentary"></textarea>
                    </ng-container>

                    <ng-container *ngSwitchCase="'Complimentary One Seat'">
                        <label for="reservation_mass_text">Email Subject</label>
                        <input class="form-control" id="reservation_mass_text" 
                        [(ngModel)]="massText" 
                        [maxlength]="_mainService.reservation_emailsubject_maxlength" 
                        [placeholder]="_mainService.reservation_emailsubject_placeholder_complimentary"
                        [title]="_mainService.reservation_emailsubject_desc">
                        <br/>
                        <label for="reservation_mass_text1">Email Body</label>
                        <textarea class="form-control" rows="5" id="reservation_mass_text1" 
                        [(ngModel)]="massText1" 
                        [maxlength]="_mainService.reservation_text_maxlength"
                        [title]="_mainService.reservation_emailbody_desc_complimentary"></textarea>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Progress Dialog -->
<div id="progressDlg" class="modal fade in" role="basic" style="padding-right: 17px;z-index:9999999999999;" >
    <div class="modal-backdrop fade in" style="height: 100%;opacity:0.28;background-color:green !important;">
    </div>
    <div class="modal-dialog" style="width:45px;height:100%;margin:auto;">
    <i class="fa fa-spinner fa-spin fa-fw" aria-hidden="true" style="font-size: 44px;top: 50%;position: absolute;color: green"></i>
    </div>
</div>

<simple-notifications [options]="notifyOptions"></simple-notifications>
